#!/usr/bin/env bash

# Exit if Gearlever isn't installed
if ! flatpak list | grep -q "it.mijorus.gearlever"; then
    echo "Gearlever not installed. Skipping AppImage updates."
    exit 0
fi

echo "=== Updating AppImages ==="

# Get list of installed AppImages
# We use || true to prevent script failure if list is empty/fails
APPS=$(flatpak run it.mijorus.gearlever --list-installed || true)

if [ -z "$APPS" ]; then
    echo "No AppImages managed by Gearlever found."
    exit 0
fi

# Iterate and Update
echo "$APPS" | while read -r APP_PATH; do
    if [ -n "$APP_PATH" ]; then
        APP_NAME=$(basename "$APP_PATH")
        echo "-> Checking updates for $APP_NAME..."
        flatpak run it.mijorus.gearlever --update "$APP_PATH"
    fi
done

echo "AppImage update check complete."